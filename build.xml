<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="all" name="text-retriever">

    <property file="build.properties"/>

    <property name="build" value="./build"/>
    <property name="service" value="${build}/text-retriever"/>
    <property name="service.src" value="./exporters"/>

    <property name="server.url" value="http://localhost:8080/exist/rest/db/"/>

    <property name="xar" value="./${project.name}-${project.version}.xar"/>

    <target name="all" depends="service,xar"/>
    <target name="rebuild" depends="clean,all"/>

    <target name="clean">
        <delete dir="${build}"/>
        <delete file="expath-pkg.xml"/>
	<delete file="${xar}"/>
    </target>

    <target name="service">
        <mkdir dir="${build}"/>
        <mkdir dir="${service}"/>
        <mkdir dir="${service}/adl"/>
        <mkdir dir="${service}/sks"/>
        <copy todir="${service}">
            <fileset dir="${service.src}/common"/>
        </copy>
        <copy todir="${service}/adl">
            <fileset dir="${service.src}/adl"/>
        </copy>
        <copy todir="${service}/sks">
            <fileset dir="${service.src}/sks"/>
        </copy>
    </target>

    <target name="xar" depends="service"  >
        <copy file="expath-pkg.xml.tmpl" tofile="expath-pkg.xml" filtering="true" overwrite="true">
            <filterset>
                <filter token="project.name" value="${project.name}"/>
                <filter token="project.version" value="${project.version}"/>
            </filterset>
        </copy>
        <zip destfile="${xar}">
            <fileset dir="build">
                <include name="text-retriever/**"/>
            </fileset>
        </zip>
    </target>

    <target name="upload">
      <input message="Enter password:" addproperty="server.pass" defaultvalue="">
	<handler type="secure"/>
      </input>
      <exec executable="curl">
	<arg line="-T ${build}/${xar} -u admin:${server.pass} ${server.url}/${xar}"/>
      </exec>
    </target>


</project>
